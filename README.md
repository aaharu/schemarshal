# schemarshal [![wercker status](https://app.wercker.com/status/ebb1f8ec249177acd0d47bd8a6a59dd2/s/master "wercker status")](https://app.wercker.com/project/byKey/ebb1f8ec249177acd0d47bd8a6a59dd2)

[![Coverage Status](https://coveralls.io/repos/github/aaharu/schemarshal/badge.svg)](https://coveralls.io/github/aaharu/schemarshal)
[![Go Report Card](https://goreportcard.com/badge/github.com/aaharu/schemarshal)](https://goreportcard.com/report/github.com/aaharu/schemarshal)

Generates Go struct types from a [JSON Schema](http://json-schema.org/).

## Installation

```bash
go get -u github.com/aaharu/schemarshal
```

## Usage

```
SYNOPSIS
  schemarshal [options] [<json_schema_file>]
OPTIONS
  -h, -help
           Show this help message.
  -f <file>, -file <file>
           Input file name.
  -o <file>, -output <file>
           Write output to file instead of stdout.
  -p <package>, -package <package>
           Package name for output. (default `main`)
  -t <package>, -type <package>
           Set default Type name.
  -v, -version
           Show version.
```

```bash
# with args
schemarshal -o api/schema/gen.go -p gen -f schema.json

# pipe
curl -s "https://raw.githubusercontent.com/aaharu/schemarshal/master/test_data/disk.json" | schemarshal
```

## TODO

- [ ] use go/ast

## Examples

```bash
schemarshal -p sample test_data/a.json
```
```go
// Code generated by schemarshal 1.0.0 `schemarshal -p sample test_data/a.json`
// DO NOT RECOMMEND EDITING THIS FILE.

package sample

import (
	"fmt"
	"strconv"
	"time"
)

type AAddressObject struct {
	City          *string `json:"city"`
	StreetAddress string  `json:"streetAddress"`
}

type APhoneNumberFugaObject map[string]interface{}

type APhoneNumberHogeObject struct {
	Aaa bool                    `json:"aaa,omitempty"`
	Bbb APhoneNumberHogeBbbEnum `json:"bbb,omitempty"`
}

type APhoneNumberItem struct {
	Code     int64                  `json:"code"`
	Fuga     map[string]interface{} `json:"fuga,omitempty"`
	Hoge     APhoneNumberHogeObject `json:"hoge,omitempty"`
	Location string                 `json:"location"`
}

type ATest3 struct {
	Hoge string `json:"hoge"`
}

type A struct {
	Address     AAddressObject     `json:"address"`
	PhoneNumber []APhoneNumberItem `json:"phoneNumber"`
	Test        []int64            `json:"test,omitempty"`
	Test2       time.Time          `json:"test2,omitempty"`
	Test3       []ATest3           `json:"test3,omitempty"`
}

type APhoneNumberHogeBbbEnum int

const (
	APhoneNumberHogeBbbEnum2 APhoneNumberHogeBbbEnum = iota
	APhoneNumberHogeBbbEnum4
	APhoneNumberHogeBbbEnum6
)

var _aPhoneNumberHogeBbbEnum = map[APhoneNumberHogeBbbEnum]interface{}{
	APhoneNumberHogeBbbEnum2: 2,
	APhoneNumberHogeBbbEnum4: 4,
	APhoneNumberHogeBbbEnum6: 6,
}

func (enum APhoneNumberHogeBbbEnum) MarshalJSON() ([]byte, error) {
	switch v := _aPhoneNumberHogeBbbEnum[enum].(type) {
	case string:
		return []byte(strconv.Quote(v)), nil
	default:
		return []byte(fmt.Sprintf("%v", v)), nil
	}
}

func (enum *APhoneNumberHogeBbbEnum) UnmarshalJSON(data []byte) error {
	for i, v := range _aPhoneNumberHogeBbbEnum {
		switch vv := v.(type) {
		case string:
			if strconv.Quote(vv) == string(data) {
				*enum = APhoneNumberHogeBbbEnum(i)
				return nil
			}
		default:
			if fmt.Sprintf("%v", v) == string(data) {
				*enum = APhoneNumberHogeBbbEnum(i)
				return nil
			}
		}
	}
	return fmt.Errorf("Error: miss-matched APhoneNumberHogeBbbEnum (%s)", data)
}

func (enum APhoneNumberHogeBbbEnum) String() string {
	switch v := _aPhoneNumberHogeBbbEnum[enum].(type) {
	case string:
		return v
	default:
		return fmt.Sprintf("%v", v)
	}
}

func ToAPhoneNumberHogeBbbEnum(val interface{}) *APhoneNumberHogeBbbEnum {
	for i, v := range _aPhoneNumberHogeBbbEnum {
		if val == v {
			return &i
		}
	}
	return nil
}

```

```bash
curl -s "http://qiita.com/api/v2/schema" | schemarshal
```
```go
// Code generated by schemarshal 1.0.0 `schemarshal`
// DO NOT RECOMMEND EDITING THIS FILE.

package main

import "time"

// QiitaAPIV2AccessTokenObject : Qiita API v2で認証・認可を行うためのアクセストークンを表します。
type QiitaAPIV2AccessTokenObject struct {
	ClientId string   `json:"client_id"`
	Scopes   []string `json:"scopes"`
	Token    string   `json:"token"`
}

// QiitaAPIV2AuthenticatedUserObject : 現在のアクセストークンで認証中のユーザを表します。通常のユーザ情報よりも詳細な情報を含んでいます。
type QiitaAPIV2AuthenticatedUserObject struct {
	Description                 *string `json:"description"`
	FacebookId                  *string `json:"facebook_id"`
	FolloweesCount              int64   `json:"followees_count"`
	FollowersCount              int64   `json:"followers_count"`
	GithubLoginName             *string `json:"github_login_name"`
	Id                          string  `json:"id"`
	ImageMonthlyUploadLimit     int64   `json:"image_monthly_upload_limit"`
	ImageMonthlyUploadRemaining int64   `json:"image_monthly_upload_remaining"`
	ItemsCount                  int64   `json:"items_count"`
	LinkedinId                  *string `json:"linkedin_id"`
	Location                    *string `json:"location"`
	Name                        *string `json:"name"`
	Organization                *string `json:"organization"`
	PermanentId                 int64   `json:"permanent_id"`
	ProfileImageUrl             string  `json:"profile_image_url"`
	TeamOnly                    bool    `json:"team_only"`
	TwitterScreenName           *string `json:"twitter_screen_name"`
	WebsiteUrl                  *string `json:"website_url"`
}

// QiitaAPIV2UserObject : Qiita上のユーザを表します。
type QiitaAPIV2UserObject struct {
	Description       *string `json:"description"`
	FacebookId        *string `json:"facebook_id"`
	FolloweesCount    int64   `json:"followees_count"`
	FollowersCount    int64   `json:"followers_count"`
	GithubLoginName   *string `json:"github_login_name"`
	Id                string  `json:"id"`
	ItemsCount        int64   `json:"items_count"`
	LinkedinId        *string `json:"linkedin_id"`
	Location          *string `json:"location"`
	Name              *string `json:"name"`
	Organization      *string `json:"organization"`
	PermanentId       int64   `json:"permanent_id"`
	ProfileImageUrl   string  `json:"profile_image_url"`
	TwitterScreenName *string `json:"twitter_screen_name"`
	WebsiteUrl        *string `json:"website_url"`
}

// QiitaAPIV2CommentObject : 投稿に付けられたコメントを表します。
type QiitaAPIV2CommentObject struct {
	Body         string               `json:"body"`
	CreatedAt    time.Time            `json:"created_at"`
	Id           string               `json:"id"`
	RenderedBody string               `json:"rendered_body"`
	UpdatedAt    time.Time            `json:"updated_at"`
	User         QiitaAPIV2UserObject `json:"user"`
}

type QiitaAPIV2 struct {
	Name     string   `json:"name"`
	Versions []string `json:"versions,omitempty"`
}

// QiitaAPIV2ExpandedTemplateObject : テンプレートを保存する前に変数展開後の状態をプレビューできます。Qiita:Teamでのみ有効です。
type QiitaAPIV2ExpandedTemplateObject struct {
	ExpandedBody  string       `json:"expanded_body"`
	ExpandedTags  []QiitaAPIV2 `json:"expanded_tags"`
	ExpandedTitle string       `json:"expanded_title"`
}

// QiitaAPIV2GroupObject : Qiita:Teamのグループを表します。
type QiitaAPIV2GroupObject struct {
	CreatedAt time.Time `json:"created_at"`
	Id        int64     `json:"id"`
	Name      string    `json:"name"`
	Private   bool      `json:"private"`
	UpdatedAt time.Time `json:"updated_at"`
	UrlName   string    `json:"url_name"`
}

// QiitaAPIV2GroupObject : Qiita:Teamのグループを表します。
type QiitaAPIV2GroupObject struct {
	CreatedAt time.Time `json:"created_at"`
	Id        int64     `json:"id"`
	Name      string    `json:"name"`
	Private   bool      `json:"private"`
	UpdatedAt time.Time `json:"updated_at"`
	UrlName   string    `json:"url_name"`
}

type QiitaAPIV2 struct {
	Name     string   `json:"name"`
	Versions []string `json:"versions,omitempty"`
}

// QiitaAPIV2UserObject : Qiita上のユーザを表します。
type QiitaAPIV2UserObject struct {
	Description       *string `json:"description"`
	FacebookId        *string `json:"facebook_id"`
	FolloweesCount    int64   `json:"followees_count"`
	FollowersCount    int64   `json:"followers_count"`
	GithubLoginName   *string `json:"github_login_name"`
	Id                string  `json:"id"`
	ItemsCount        int64   `json:"items_count"`
	LinkedinId        *string `json:"linkedin_id"`
	Location          *string `json:"location"`
	Name              *string `json:"name"`
	Organization      *string `json:"organization"`
	PermanentId       int64   `json:"permanent_id"`
	ProfileImageUrl   string  `json:"profile_image_url"`
	TwitterScreenName *string `json:"twitter_screen_name"`
	WebsiteUrl        *string `json:"website_url"`
}

// QiitaAPIV2ItemObject : ユーザからの投稿を表します。
type QiitaAPIV2ItemObject struct {
	Body         string                `json:"body"`
	Coediting    bool                  `json:"coediting"`
	CreatedAt    time.Time             `json:"created_at"`
	Group        QiitaAPIV2GroupObject `json:"group"`
	Id           string                `json:"id"`
	Private      bool                  `json:"private"`
	RenderedBody string                `json:"rendered_body"`
	Tags         []QiitaAPIV2          `json:"tags"`
	Title        string                `json:"title"`
	UpdatedAt    time.Time             `json:"updated_at"`
	Url          string                `json:"url"`
	User         QiitaAPIV2UserObject  `json:"user"`
}

// QiitaAPIV2UserObject : Qiita上のユーザを表します。
type QiitaAPIV2UserObject struct {
	Description       *string `json:"description"`
	FacebookId        *string `json:"facebook_id"`
	FolloweesCount    int64   `json:"followees_count"`
	FollowersCount    int64   `json:"followers_count"`
	GithubLoginName   *string `json:"github_login_name"`
	Id                string  `json:"id"`
	ItemsCount        int64   `json:"items_count"`
	LinkedinId        *string `json:"linkedin_id"`
	Location          *string `json:"location"`
	Name              *string `json:"name"`
	Organization      *string `json:"organization"`
	PermanentId       int64   `json:"permanent_id"`
	ProfileImageUrl   string  `json:"profile_image_url"`
	TwitterScreenName *string `json:"twitter_screen_name"`
	WebsiteUrl        *string `json:"website_url"`
}

// QiitaAPIV2LikeObject : 投稿につけられた「いいね！」を表します。Qiita:Teamでのみ有効です。
type QiitaAPIV2LikeObject struct {
	CreatedAt time.Time            `json:"created_at"`
	User      QiitaAPIV2UserObject `json:"user"`
}

// QiitaAPIV2ProjectObject : Qiita:Team上でのプロジェクトを表します。Qiita:Teamでのみ有効です。
type QiitaAPIV2ProjectObject struct {
	Archived     bool      `json:"archived"`
	Body         string    `json:"body"`
	CreatedAt    time.Time `json:"created_at"`
	Id           int64     `json:"id"`
	Name         string    `json:"name"`
	RenderedBody string    `json:"rendered_body"`
	UpdatedAt    time.Time `json:"updated_at"`
}

// QiitaAPIV2UserObject : Qiita上のユーザを表します。
type QiitaAPIV2UserObject struct {
	Description       *string `json:"description"`
	FacebookId        *string `json:"facebook_id"`
	FolloweesCount    int64   `json:"followees_count"`
	FollowersCount    int64   `json:"followers_count"`
	GithubLoginName   *string `json:"github_login_name"`
	Id                string  `json:"id"`
	ItemsCount        int64   `json:"items_count"`
	LinkedinId        *string `json:"linkedin_id"`
	Location          *string `json:"location"`
	Name              *string `json:"name"`
	Organization      *string `json:"organization"`
	PermanentId       int64   `json:"permanent_id"`
	ProfileImageUrl   string  `json:"profile_image_url"`
	TwitterScreenName *string `json:"twitter_screen_name"`
	WebsiteUrl        *string `json:"website_url"`
}

// QiitaAPIV2ReactionObject : 絵文字リアクションを表します。
type QiitaAPIV2ReactionObject struct {
	CreatedAt time.Time            `json:"created_at"`
	ImageUrl  string               `json:"image_url"`
	Name      string               `json:"name"`
	User      QiitaAPIV2UserObject `json:"user"`
}

// QiitaAPIV2TagObject : 投稿に付けられた個々のタグを表します。
type QiitaAPIV2TagObject struct {
	FollowersCount int64   `json:"followers_count"`
	IconUrl        *string `json:"icon_url"`
	Id             string  `json:"id"`
	ItemsCount     int64   `json:"items_count"`
}

// QiitaAPIV2TaggingObject : 投稿とタグとの関連を表します。
type QiitaAPIV2TaggingObject struct {
	Name     string   `json:"name"`
	Versions []string `json:"versions"`
}

// QiitaAPIV2TeamObject : Qiita:Team上で所属しているチームを表します。Qiita:Teamでのみ有効です。
type QiitaAPIV2TeamObject struct {
	Active bool   `json:"active"`
	Id     string `json:"id"`
	Name   string `json:"name"`
}

type QiitaAPIV2 struct {
	Name     string   `json:"name"`
	Versions []string `json:"versions,omitempty"`
}

type QiitaAPIV2 struct {
	Name     string   `json:"name"`
	Versions []string `json:"versions,omitempty"`
}

// QiitaAPIV2TemplateObject : 投稿のひな形に利用できるテンプレートを表します。Qiita:Teamでのみ有効です。
type QiitaAPIV2TemplateObject struct {
	Body          string       `json:"body"`
	ExpandedBody  string       `json:"expanded_body"`
	ExpandedTags  []QiitaAPIV2 `json:"expanded_tags"`
	ExpandedTitle string       `json:"expanded_title"`
	Id            int64        `json:"id"`
	Name          string       `json:"name"`
	Tags          []QiitaAPIV2 `json:"tags"`
	Title         string       `json:"title"`
}

// QiitaAPIV2UserObject : Qiita上のユーザを表します。
type QiitaAPIV2UserObject struct {
	Description       *string `json:"description"`
	FacebookId        *string `json:"facebook_id"`
	FolloweesCount    int64   `json:"followees_count"`
	FollowersCount    int64   `json:"followers_count"`
	GithubLoginName   *string `json:"github_login_name"`
	Id                string  `json:"id"`
	ItemsCount        int64   `json:"items_count"`
	LinkedinId        *string `json:"linkedin_id"`
	Location          *string `json:"location"`
	Name              *string `json:"name"`
	Organization      *string `json:"organization"`
	PermanentId       int64   `json:"permanent_id"`
	ProfileImageUrl   string  `json:"profile_image_url"`
	TwitterScreenName *string `json:"twitter_screen_name"`
	WebsiteUrl        *string `json:"website_url"`
}

// QiitaAPIV2JSONSchema : このスキーマ定義では、Qiita API v2 のインターフェースをJSON Hyper Schema draft v4形式で表現しています。
type QiitaAPIV2JSONSchema struct {
	AccessToken       QiitaAPIV2AccessTokenObject       `json:"access_token"`
	AuthenticatedUser QiitaAPIV2AuthenticatedUserObject `json:"authenticated_user"`
	Comment           QiitaAPIV2CommentObject           `json:"comment"`
	ExpandedTemplate  QiitaAPIV2ExpandedTemplateObject  `json:"expanded_template"`
	Group             QiitaAPIV2GroupObject             `json:"group"`
	Item              QiitaAPIV2ItemObject              `json:"item"`
	Like              QiitaAPIV2LikeObject              `json:"like"`
	Project           QiitaAPIV2ProjectObject           `json:"project"`
	Reaction          QiitaAPIV2ReactionObject          `json:"reaction"`
	Tag               QiitaAPIV2TagObject               `json:"tag"`
	Tagging           QiitaAPIV2TaggingObject           `json:"tagging"`
	Team              QiitaAPIV2TeamObject              `json:"team"`
	Template          QiitaAPIV2TemplateObject          `json:"template"`
	User              QiitaAPIV2UserObject              `json:"user"`
}

```

## Dependencies

* https://github.com/lestrrat/go-jsschema
  - JSON Schema parser
  - MIT License
* golang.org/x/crypto/ssh/terminal
  - https://godoc.org/golang.org/x/crypto/ssh/terminal
  - https://golang.org/LICENSE

## Similar Projects

* https://github.com/idubinskiy/schematyper
* https://github.com/dameleon/structr
* https://github.com/interagent/schematic

## License

BSD-2-Clause
