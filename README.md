# schemarshal [![wercker status](https://app.wercker.com/status/ebb1f8ec249177acd0d47bd8a6a59dd2/s/master "wercker status")](https://app.wercker.com/project/byKey/ebb1f8ec249177acd0d47bd8a6a59dd2)

[![Coverage Status](https://coveralls.io/repos/github/aaharu/schemarshal/badge.svg)](https://coveralls.io/github/aaharu/schemarshal)

Generates Go struct types from a [JSON Schema](http://json-schema.org/).

## Installation

```bash
go get -u github.com/aaharu/schemarshal
```

## Usage

```
SYNOPSIS
  schemarshal [options] [<json_schema_file>]
OPTIONS
  -h, -help
           Show this help message.
  -f <file>, -file <file>
           Input file name.
  -o <file>, -output <file>
           Write output to file instead of stdout.
  -p <package>, -package <package>
           Package name for output. (default `main`)
  -t <package>, -type <package>
           Set default Type name.
  -v, -version
           Show version.
```

```bash
# with args
schemarshal -o api/schema/gen.go -p gen -f schema.json

# pipe
curl -s "https://raw.githubusercontent.com/aaharu/schemarshal/master/test_data/disk.json" | schemarshal
```

## TODO

- [ ] use go/ast

## Examples

```bash
schemarshal -p sample test_data/a.json
```
```go
// generated by schemarshal 0.4.2 `schemarshal -p sample test_data/a.json`
// DO NOT RECOMMEND EDITING THIS FILE.

package sample

import (
	"fmt"
	"strconv"
	"time"
)

type A struct {
	Test        time.Time `json:"test2,omitempty"`
	PhoneNumber []struct {
		Location string `json:"location"`
		Code     int    `json:"code"`
		Hoge     struct {
			Aaa bool                    `json:"aaa,omitempty"`
			Bbb APhoneNumberHogeBbbEnum `json:"bbb,omitempty"`
		} `json:"hoge,omitempty"`
		Fuga map[string]interface{} `json:"fuga,omitempty"`
	} `json:"phoneNumber"`
	Address struct {
		StreetAddress string  `json:"streetAddress"`
		City          *string `json:"city"`
	} `json:"address"`
	Test []int `json:"test,omitempty"`
}

type APhoneNumberHogeBbbEnum int

const (
	APhoneNumberHogeBbbEnum2 APhoneNumberHogeBbbEnum = iota
	APhoneNumberHogeBbbEnum4
	APhoneNumberHogeBbbEnum6
)

func (enum APhoneNumberHogeBbbEnum) MarshalJSON() ([]byte, error) {
	var enumList = []interface{}{
		2,
		4,
		6,
	}
	switch v := enumList[enum].(type) {
	case string:
		return []byte(strconv.Quote(v)), nil
	default:
		return []byte(fmt.Sprintf("%v", v)), nil
	}
}

```

```bash
curl -s "https://raw.githubusercontent.com/aaharu/schemarshal/master/test_data/disk.json" | schemarshal
```
```go
// generated by schemarshal 0.4.2 `schemarshal`
// DO NOT RECOMMEND EDITING THIS FILE.

package main

import (
	"fmt"
	"strconv"
)

type Disk struct {
	Type   DiskTypeEnum   `json:"type"`
	Device string         `json:"device"`
	Test   []DiskTestEnum `json:"test,omitempty"`
}

type DiskTypeEnum int

const (
	DiskTypeEnumDisk DiskTypeEnum = iota
	DiskTypeEnumDisk2
	DiskTypeEnumABC
)

func (enum DiskTypeEnum) MarshalJSON() ([]byte, error) {
	var enumList = []interface{}{
		"disk",
		"disk2",
		"a\"b\\c",
	}
	switch v := enumList[enum].(type) {
	case string:
		return []byte(strconv.Quote(v)), nil
	default:
		return []byte(fmt.Sprintf("%v", v)), nil
	}
}

type DiskTestEnum int

const (
	DiskTestEnumX DiskTestEnum = iota
	DiskTestEnumY
)

func (enum DiskTestEnum) MarshalJSON() ([]byte, error) {
	var enumList = []interface{}{
		"x",
		"y",
	}
	switch v := enumList[enum].(type) {
	case string:
		return []byte(strconv.Quote(v)), nil
	default:
		return []byte(fmt.Sprintf("%v", v)), nil
	}
}

```

## Dependencies

* https://github.com/lestrrat/go-jsschema
  - JSON Schema parser
  - MIT License
* golang.org/x/crypto/ssh/terminal
  - https://godoc.org/golang.org/x/crypto/ssh/terminal
  - https://golang.org/LICENSE

## Similar Projects

* https://github.com/idubinskiy/schematyper
* https://github.com/dameleon/structr
* https://github.com/interagent/schematic

## License

BSD-2-Clause
