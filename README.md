# schemarshal [![wercker status](https://app.wercker.com/status/ebb1f8ec249177acd0d47bd8a6a59dd2/s/master "wercker status")](https://app.wercker.com/project/byKey/ebb1f8ec249177acd0d47bd8a6a59dd2)

[![Coverage Status](https://coveralls.io/repos/github/aaharu/schemarshal/badge.svg)](https://coveralls.io/github/aaharu/schemarshal)

Generates Go struct types from a [JSON Schema](http://json-schema.org/).

## Installation

```bash
go get -u github.com/aaharu/schemarshal
```

## Usage

```
SYNOPSIS
  schemarshal [options] [<json_schema_file>]
OPTIONS
  -h, -help
           Show this help message.
  -f <file>, -file <file>
           Input file name.
  -o <file>, -output <file>
           Write output to file instead of stdout.
  -p <package>, -package <package>
           Package name for output. (default `main`)
  -t <package>, -type <package>
           Set default Type name.
  -v, -version
           Show version.
```

```bash
# with args
schemarshal -o api/schema/gen.go -p gen -f schema.json

# pipe
curl -s "https://raw.githubusercontent.com/aaharu/schemarshal/master/test_data/disk.json" | schemarshal
```

## TODO

- [ ] use go/ast

## Examples

```bash
schemarshal -p sample test_data/a.json
```
```go
// generated by schemarshal 0.7.2 `schemarshal -p sample test_data/a.json`
// DO NOT RECOMMEND EDITING THIS FILE.

package sample

import (
	"fmt"
	"strconv"
	"time"
)

type AAddressObject struct {
	City          *string `json:"city"`
	StreetAddress string  `json:"streetAddress"`
}
type APhoneNumberFugaObject map[string]interface{}
type APhoneNumberHogeObject struct {
	Aaa bool                    `json:"aaa,omitempty"`
	Bbb APhoneNumberHogeBbbEnum `json:"bbb,omitempty"`
}
type APhoneNumberItem struct {
	Code     int                    `json:"code"`
	Fuga     map[string]interface{} `json:"fuga,omitempty"`
	Hoge     APhoneNumberHogeObject `json:"hoge,omitempty"`
	Location string                 `json:"location"`
}
type ATest3 struct {
	Hoge string `json:"hoge"`
}
type A struct {
	Address     AAddressObject     `json:"address"`
	PhoneNumber []APhoneNumberItem `json:"phoneNumber"`
	Test        []int              `json:"test,omitempty"`
	Test2       time.Time          `json:"test2,omitempty"`
	Test3       []ATest3           `json:"test3,omitempty"`
}

type APhoneNumberHogeBbbEnum int

const (
	APhoneNumberHogeBbbEnum2 APhoneNumberHogeBbbEnum = iota
	APhoneNumberHogeBbbEnum4
	APhoneNumberHogeBbbEnum6
)

func (enum APhoneNumberHogeBbbEnum) MarshalJSON() ([]byte, error) {
	var enumList = []interface{}{
		2,
		4,
		6,
	}
	switch v := enumList[enum].(type) {
	case string:
		return []byte(strconv.Quote(v)), nil
	default:
		return []byte(fmt.Sprintf("%v", v)), nil
	}
}

func (enum APhoneNumberHogeBbbEnum) UnmarshalJSON(data []byte) error {
	var enumList = []interface{}{
		2,
		4,
		6,
	}
	for i, v := range enumList {
		switch vv := v.(type) {
		case string:
			if strconv.Quote(vv) == string(data) {
				enum = APhoneNumberHogeBbbEnum(i)
				return nil
			}
		default:
			if fmt.Sprintf("%v", v) == string(data) {
				enum = APhoneNumberHogeBbbEnum(i)
				return nil
			}
		}
	}
	return fmt.Errorf("Error: miss-matched APhoneNumberHogeBbbEnum (%s)", data)
}

```

```bash
curl -s "https://raw.githubusercontent.com/aaharu/schemarshal/master/test_data/disk.json" | schemarshal
```
```go
// Code generated by schemarshal 0.7.2 `schemarshal`
// DO NOT RECOMMEND EDITING THIS FILE.

package main

import (
	"fmt"
	"strconv"
)

type SchemarshalType struct {
	Device string                    `json:"device"`
	Test   []SchemarshalTypeTestEnum `json:"test,omitempty"`
	Type   SchemarshalTypeTypeEnum   `json:"type"`
}

type SchemarshalTypeTestEnum int

const (
	SchemarshalTypeTestEnumX SchemarshalTypeTestEnum = iota
	SchemarshalTypeTestEnumY
)

func (enum SchemarshalTypeTestEnum) MarshalJSON() ([]byte, error) {
	var enumList = []interface{}{
		"x",
		"y",
	}
	switch v := enumList[enum].(type) {
	case string:
		return []byte(strconv.Quote(v)), nil
	default:
		return []byte(fmt.Sprintf("%v", v)), nil
	}
}

func (enum SchemarshalTypeTestEnum) UnmarshalJSON(data []byte) error {
	var enumList = []interface{}{
		"x",
		"y",
	}
	for i, v := range enumList {
		switch vv := v.(type) {
		case string:
			if strconv.Quote(vv) == string(data) {
				enum = SchemarshalTypeTestEnum(i)
				return nil
			}
		default:
			if fmt.Sprintf("%v", v) == string(data) {
				enum = SchemarshalTypeTestEnum(i)
				return nil
			}
		}
	}
	return fmt.Errorf("Error: miss-matched SchemarshalTypeTestEnum (%s)", data)
}

type SchemarshalTypeTypeEnum int

const (
	SchemarshalTypeTypeEnumDisk SchemarshalTypeTypeEnum = iota
	SchemarshalTypeTypeEnumDisk2
	SchemarshalTypeTypeEnumABC
)

func (enum SchemarshalTypeTypeEnum) MarshalJSON() ([]byte, error) {
	var enumList = []interface{}{
		"disk",
		"disk2",
		"a\"b\\c",
	}
	switch v := enumList[enum].(type) {
	case string:
		return []byte(strconv.Quote(v)), nil
	default:
		return []byte(fmt.Sprintf("%v", v)), nil
	}
}

func (enum SchemarshalTypeTypeEnum) UnmarshalJSON(data []byte) error {
	var enumList = []interface{}{
		"disk",
		"disk2",
		"a\"b\\c",
	}
	for i, v := range enumList {
		switch vv := v.(type) {
		case string:
			if strconv.Quote(vv) == string(data) {
				enum = SchemarshalTypeTypeEnum(i)
				return nil
			}
		default:
			if fmt.Sprintf("%v", v) == string(data) {
				enum = SchemarshalTypeTypeEnum(i)
				return nil
			}
		}
	}
	return fmt.Errorf("Error: miss-matched SchemarshalTypeTypeEnum (%s)", data)
}

```

## Dependencies

* https://github.com/lestrrat/go-jsschema
  - JSON Schema parser
  - MIT License
* golang.org/x/crypto/ssh/terminal
  - https://godoc.org/golang.org/x/crypto/ssh/terminal
  - https://golang.org/LICENSE

## Similar Projects

* https://github.com/idubinskiy/schematyper
* https://github.com/dameleon/structr
* https://github.com/interagent/schematic

## License

BSD-2-Clause
